{% extends "base.html" %}
{% block title %}
SwarmOps | Docker管理平台
{% endblock %}
{% block container %}
{% if request.args.get("misc") == "AddSwarm" %}
<form class="form-horizontal" role="form" id="AddSwarmForm">

  <div class="form-group">
    <label for="AddSwarmName" class="col-sm-12">Swarm Name</label>
    <div class="col-sm-12">
      <input type="text" class="form-control" id="AddSwarmName" name="name" placeholder="Swarm集群标识名称">
    </div>
  </div>

  <div class="form-group ">
    <label for="AddSwarmIp" class="col-sm-12">Swarm Ip</label>
    <div class="col-sm-12">
      <input type="text" class="form-control" id="AddSwarmIp" name="ip" placeholder="Swarm集群任意节点IP">
    </div>
  </div>

  <div class="form-group">
    <div class=" col-sm-12">
      <button type="button" onclick=AddSwarm() class="btn btn-default">添加集群</button>
    </div>
  </div>

</form>
{% endif %}
{% if request.args.get("misc") == "DelSwarm" %}
<div class="alert alert-danger" role="alert">活跃集群<code>{{ g.swarm.getAcitve.name }}</code>不允许删除!!!</div>
<strong class="text-success "><span class="glyphicon glyphicon-arrow-down"></span>Swarm集群标识名称列表<scan class="badge"> {{ g.swarm.getMember|length }}</scan><span class="glyphicon glyphicon-arrow-down"></span></strong>
<br />
<br />
<p>{% for member in g.swarm.getMember %}<code class="text-muted"> {{ member }} </code>&nbsp;{% endfor %}</p>
<br />

<form class="form-horizontal" role="form" id="DelSwarmForm">

  <div class="form-group">
    <label for="DelSwarmName" class="col-sm-12">Swarm Name</label>
    <div class="col-sm-12">
      <input type="text" class="form-control" id="DelSwarmName" name="name" placeholder="Swarm集群标识名称, 如果要删除多个集群, 请用空格区分">
    </div>
  </div>

  <div class="form-group">
    <div class=" col-sm-12">
      <button type="button" onclick=DelSwarm() class="btn btn-danger">删除集群</button>
    </div>
  </div>

</form>
{% endif %}
{% endblock %}
{% block script %}
<script type="text/javascript">
{% if request.args.get("misc") == "AddSwarm" %}
function AddSwarm() {
    $.ajax({
        url: "{{ url_for('apis.core.swarm') }}",
        method: 'POST',
        datatype: 'json',
        data: $('#AddSwarmForm').serialize(),
        success: function(res) {
            console.log(res);
            if (res.success==true) {
                alert("添加Swarm集群成功！");
                window.location.href="{{ url_for('ui.index') }}";
            } else {
                alert("添加Swarm集群失败，请重试提交或报告错误！\n错误原因是：" + res.msg);
            }
        },
    });
}
{% endif %}
{% if request.args.get("misc") == "DelSwarm" %}
function DelSwarm() {
  var delname  = $("input#DelSwarmName").val()
  if (delname) {
    if(window.confirm("你确定要删除" + delname +"？")) {
        var delnames = delname.split(" ");
        var SUCCESS  = new Array();
        var FAILED   = new Array();
        console.log(delnames);
        for (i=0;i<delnames.length ;i++ ) {
            name = delnames[i];
            if (name) {
                $.ajax({
                    url: "{{ url_for('apis.core.swarm') }}",
                    method: 'DELETE',
                    async: false,
                    datatype: 'json',
                    data: {"name": name},
                    success: function(res) {
                        console.log(res);
                        if (res.success==true) {
                            console.log("Delete Swarm Successfully:" + name);
                            SUCCESS.push(name);
                        } else {
                            console.log("Delete Swarm Failed:" + name);
                            FAILED.push(name);
                        }
                    },
                });
            }
        }
        if (SUCCESS.length!==0) {
            alert("Swarm集群删除成功列表：" + SUCCESS);
        }
        if (FAILED.length!==0) {
            alert("Swarm集群删除失败列表：" + FAILED);
        }
    }
  } else {
      alert("请填写要删除的Swarm集群标识名称！");
  }
}
{% endif %}

</script>
{% endblock %}
