{% extends "base.html" %}
{% block title %}
SwarmOps | Docker管理平台
{% endblock %}
{% block container %}
{% if request.args.get("misc") == "AddSwarm" %}
<form class="form-horizontal" role="form" id="AddSwarmForm">

  <div class="form-group">
    <label for="AddSwarmName" class="col-sm-12">Swarm Name</label>
    <div class="col-sm-12">
      <input type="text" class="form-control" id="AddSwarmName" name="name" placeholder="Swarm集群标识名称">
    </div>
  </div>

  <div class="form-group ">
    <label for="AddSwarmIp" class="col-sm-12">Swarm Ip</label>
    <div class="col-sm-12">
      <input type="text" class="form-control" id="AddSwarmIp" name="ip" placeholder="Swarm集群任意节点IP">
    </div>
  </div>

  <div class="form-group">
    <div class=" col-sm-12">
      <button type="button" onclick=AddSwarm() class="btn btn-default">添加集群</button>
    </div>
  </div>

</form>
{% endif %}
{% if request.args.get("misc") == "DelSwarm" %}
<form class="form-horizontal" role="form" id="DelSwarmForm">

  <div class="form-group">
    <label for="DelSwarmName" class="col-sm-12">Swarm Name</label>
    <div class="col-sm-12">
      <input type="text" class="form-control" id="DelSwarmName" name="name" id="delname" placeholder="Swarm集群标识名称, 如果要删除多个集群, 请用空格区分">
    </div>
  </div>

  <div class="form-group">
    <div class=" col-sm-12">
      <button type="button" onclick=DelSwarm() class="btn btn-danger">删除集群</button>
    </div>
  </div>

</form>
{% endif %}
{% endblock %}
{% block script %}
<script type="text/javascript">
{% if request.args.get("misc") == "AddSwarm" %}
function AddSwarm() {
    $.ajax({
        url: "{{ url_for('apis.core.swarm') }}",
        method: 'POST',
        datatype: 'json',
        data: $('#AddSwarmForm').serialize(),
        success: function(res) {
            console.log(res);
            if (res.success==true) {
                alert("添加Swarm集群成功！");
                window.location.href="{{ url_for('ui.index') }}";
            } else {
                alert("添加Swarm集群失败，请重试提交或报告错误！\n错误原因是：" + res.msg);
            }
        },
    });
}
{% endif %}
{% if request.args.get("misc") == "DelSwarm" %}
function DelSwarm() {
  var delname = document.getElementById('delname').value;
  if (delname) {
    if(window.confirm("你确定要删除？")){
        $.ajax({
            url: "{{ url_for('apis.core.swarm') }}",
            method: 'DELETE',
            datatype: 'json',
            data: $('#DelSwarmForm').serialize(),
            success: function(res) {
                console.log(res);
                if (res.success==true) {
                    alert("删除Swarm集群成功！");
                } else {
                    alert("删除Swarm集群失败，请重试提交或报告错误！\n错误原因是：" + res.msg);
                }
            },
        });
    }
  } else {
      alert("请填写Swarm标识名称");
  }
}
{% endif %}

</script>
{% endblock %}
